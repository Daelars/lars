---
const requestUrl = new URL(Astro.request.url);
const apiUrl = `${requestUrl.origin}/api/files`;
console.log("Fetching from:", apiUrl);
const response = await fetch(apiUrl);
console.log("Response status:", response.status);

if (!response.ok) {
  throw new Error(`HTTP error! status: ${response.status}`);
}

const text = await response.text();
try {
  const files = JSON.parse(text);
  console.log(files);
} catch (error) {
  console.error("Error parsing JSON:", error);
  console.error("Received text:", text);
}
---

<html>
  <head>
    <title>Files List</title>
  </head>
  <body>
    <h1>Files</h1>
    <ul>
      {data.files?.map((file) => <li>{file.name}</li>)}
    </ul>
  </body>
</html>
