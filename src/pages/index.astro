---
let data: any; // Declare `data` with type `any` at the top level if its type is uncertain

try {
  const requestUrl = new URL(Astro.request.url);
  const apiUrl = `${requestUrl.origin}/api/files_api`;
  const response = await fetch(apiUrl);

  if (!response.ok) {
    throw new Error(`HTTP error! status: ${response.status}`);
  }

  const text = await response.text();
  data = JSON.parse(text); // Since `data` is already declared, we're just assigning it here
} catch (error) {
  console.error("Error fetching or parsing data:", error);
  data = []; // Provide a fallback value that matches the expected type structure
}
---

<html>
  <head>
    <title>Files List</title>
  </head>
  <body>
    <h1>Files</h1>
    <ul>
      {data.map((file) => <li>{file.name}</li>)}
    </ul>
  </body>
</html>
